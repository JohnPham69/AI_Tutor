# BÀI 16
# KIỂM THỬ VÀ GỠ LỖI CHƯƠNG TRÌNH

## Học xong bài này, em sẽ:

- Biết và khắc phục được một số lỗi thường gặp khi viết chương trình.
- Bước đầu thực hiện được một số truy vết đơn giản để tìm và gỡ lỗi cho chương trình Python.

Có những chương trình còn lỗi vì khi thực hiện cho ra kết quả sai. Theo em, việc biết giá trị của một số biến ngay sau khi mỗi câu lệnh được thực hiện có thể giúp tìm ra lỗi của chương trình hay không?

## 1) Lỗi trong chương trình và kiểm thử

Trong những phần trước, các bài tập và bài thực hành không quá phức tạp. Đã lần nào em soạn chương trình và thực hiện được ngay từ lần chạy đầu tiên chưa?

Chương trình chúng ta viết ra rất có thể có lỗi. Ngay cả những người lập trình giàu kinh nghiệm cũng có thể viết ra những chương trình còn lỗi. Quá trình xác định lỗi và sửa lỗi được gọi là gỡ lỗi. Người lập trình thường gặp các loại lỗi như sau:

- Lỗi cú pháp là lỗi câu lệnh viết không theo đúng quy định của ngôn ngữ, ví dụ như thiếu hoặc thừa dấu ngoặc trong biểu thức, tên biến sai quy cách,... Loại lỗi này được môi trường lập trình phát hiện và thông báo báo khá cụ thể, rõ ràng, cả về đặc trưng lỗi và nơi xảy ra lỗi.
- Lỗi ngoại lệ (Exceptions Error) còn gọi là lỗi Runtime, là lỗi xảy ra khi chương trình đang chạy, một lệnh nào đó không thể thực hiện được. Lỗi này sẽ được thông báo ngay trên màn hình.
- Lỗi ngữ nghĩa (còn gọi là lỗi logic) là lỗi mặc dù các câu lệnh viết đúng quy định của ngôn ngữ nhưng sai trong thao tác xử lí nào đó, ví dụ như viết nhầm dấu phép tính, nhầm tên biến, gọi hàm có tham số không đúng kiểu, chỉ sai phạm vi duyệt, thiếu câu lệnh cần thiết,... Đây là loại lỗi rất khó phát hiện vì trong rất nhiều trường hợp chương trình vẫn vẫn được thực hiện trọn vẹn, nhưng kết quả đưa ra không phù hợp hoặc kết quả sai với một số bộ dữ liệu vào nào đó.

## 2) Truy vết với cách bổ sung câu lệnh theo dõi kết quả trung gian

Tại sao rất khó phát hiện lỗi nếu chỉ dùng biện pháp đọc kĩ lại chương trình?

Một cách tìm lỗi ngữ nghĩa rất hay được dùng là bổ sung vào chương trình những câu lệnh đưa ra các kết quả trung gian nhằm truy vết các xử lí của chương trình. Với cách đó, ta có thể dự đoán và khoanh vùng được phần chương trình chứa các câu lệnh đưa đến kết quả sai.

Sau khi đã chỉnh sửa xong chương trình, ta cần xoá đi các câu lệnh đã thêm để truy vết hoặc biến chúng thành dòng thông tin chú thích.

Các sai sót có thể xảy ra ngay khi nhập dữ liệu vào, vì vậy đây cũng là chỗ cần quan tâm khi tìm lỗi.

Trong ví dụ ở mục 1, hiện tượng chương trình cho kết quả sai có thể do nguyên nhân ở khâu nhập dữ liệu hoặc ở phạm vi tìm kiếm max. Để tìm xem lỗi ở đâu, ta có thể thêm câu lệnh đưa ra các phần tử tham gia tìm kiếm max (câu lệnh print("i = ", i, "max= ",max). Câu lệnh này cần đặt sau câu lệnh `if` ở trong vòng lặp `for`.

## 3) Truy vết với công cụ gỡ lỗi của ngôn ngữ lập trình

Phương pháp truy vết đã nêu ở mục 2 đòi hỏi phải can thiệp trực tiếp vào chương trình nguồn, thêm các câu lệnh mới và sau đó phải xoá các câu lệnh truy vết không còn cần thiết. Mỗi lần thay đổi chương trình nguồn, ta cần lưu chương trình và thực hiện lại từ đầu. Điều này bất tiện vì câu lệnh mới đưa vào cũng có thể có lỗi hoặc đưa nhầm vào vị trí không thích hợp.

Để người lập trình không cần phải can thiệp vào chương trình nguồn mà vẫn truy vết tìm lỗi được, ngôn ngữ Python cung cấp công cụ Debug (gỡ lỗi).

Để kích hoạt chế độ gỡ lỗi, cần thực hiện lần lượt các thao tác sau:

- Trên cửa sổ Shell, mở file chương trình trình cần gỡ lỗi, kết quả là chương trình này xuất hiện (trong cửa sổ Code).
- Chọn Debug trên cửa sổ Shell và sau đó chọn Debugger. Kết quả là cửa sổ Debug Control sẽ xuất hiện.

## 4) Thực hành gỡ lỗi cho chương trình

Bài toán: Cho a là danh sách các số nguyên. Em hãy tạo danh sách b có các phần tử ở vị trí lẻ bằng phần tử ở vị trí tương ứng của a, các phần tử ở vị trí chẵn bằng phần tử ở vị trí tương ứng của a cộng thêm 1, tức là:

    b_i = { a_i + 1, i = 0, 2, 4,...
          { a_i, i = 1, 3, 5,...

## Tóm tắt bài học

- Có ba loại bộ dữ liệu vào cần tạo để kiểm tra, đánh giá chương trình.
- Lỗi ngữ nghĩa khó phát hiện.
- Để tìm và sửa lỗi ngữ nghĩa cần dùng biện pháp truy vết.
- Muốn truy vết để tìm lỗi:
    - Có thể đưa thêm các câu lệnh xuất ra kết quả trung gian của quá trình tính toán.
    - Có thể sử dụng công cụ gỡ lỗi của môi trường lập trình.
- Trên cửa sổ Debug Control có phần hiển thị thông tin về giá trị các biến trong chương trình.
