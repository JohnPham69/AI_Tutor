## CHỦ ĐỀ F. GIẢI QUYẾT VẤN ĐỀ VỚI SỰ TRỢ GIÚP CỦA MÁY TÍNH
## GIỚI THIỆU CÁC HỆ CƠ SỞ DỮ LIỆU

# BÀI 3
# QUAN HỆ GIỮA CÁC BẢNG VÀ KHOÁ NGOÀI TRONG CƠ SỞ DỮ LIỆU QUAN HỆ

### Học xong bài này, em sẽ:

- Diễn đạt được khái niệm khoá ngoại của một bảng và mối liên kết giữa các bảng. Giải thích được các khái niệm đó qua ví dụ minh hoạ.
- Giải thích được ràng buộc khoá ngoại là gì.
- Biết được các phần mềm quản trị CSDL có cơ chế kiểm soát các cập nhật dữ liệu để đảm bảo ràng buộc khoá ngoại.

# 1 Tinh dư thừa dữ liệu

### a) Dư thừa dữ liệu có thể dẫn đến dữ liệu không nhất quán khi cập nhật

Có thể một số người nghi rằng nên đưa tất cả dữ liệu cần lưu trữ vào trong một bảng vì khi cần tìm thông tin nào đó thì chỉ phải tìm trong một bảng. Nhưng thực tế cho thấy đa số bài toán quản lí cần dùng nhiều hơn một bảng dữ liệu. Nếu chỉ dùng một bảng thì rất có thể dẫn đến tình trạng dư thừa dữ liệu. Ví dụ, trường hợp nếu ở phần khởi động, giả sử học sinh có số thẻ TV "HS-002" tên là "Lê Bình" sinh ngày "02/3/2007", học lớp "11A1" đã có 68 lần mượn sách. Như vậy, bộ giá trị ("HS-002", "Lê Bình", "02/3/2007", "11A1") phải xuất hiện 68 lần (trên 68 bản ghi của bảng). Tình trạng dư thừa dữ liệu có thể dẫn đến sai nhằm, không nhất quán về dữ liệu. Việc gõ nhập 68 lần bộ dữ liệu về Lê Bình sẽ dễ xuất hiện sai nhầm hơn so với 68 lần chỉ gõ Số thẻ TV của Lê Bình vào bảng. Giải pháp tránh dư thừa là có thể dùng một bảng khác chỉ chứa dữ liệu về người đọc và có khoá chính là trường Số thẻ TV.

### b) CSDL cần được thiết kế để tránh dư thừa dữ liệu

Dư thừa dữ liệu do trùng lặp dữ liệu có các nhược điểm là tốn nhiều vùng nhớ lưu trữ không cần thiết và dữ liệu có thể không nhất quán (dữ liệu bị mâu thuẫn) khi cập nhật dữ liệu.

Để tránh những nhược điểm do dư thừa dữ liệu gây ra, CSDL quan hệ thường được thiết kế gồm một số bảng, có bảng chứa dữ liệu về riêng mỗi đối tượng (cá thể) cần quản lí, có bảng chứa dữ liệu về những sự kiện liên quan đến các đối tượng được quản lí. Ví dụ, ở một thư viện nhỏ, CSDL có thể gồm 3 bảng:
- Bảng SÁCH chứa dữ liệu về các quyển sách của thư viện.
- Bảng NGƯỜI ĐỌC chứa dữ liệu về những người đọc (có thể thư viện).
- Bảng MƯỢN-TRẢ chứa dữ liệu về sự việc một người mượn/trả một quyển sách, sự việc này liên quan đến hai đối tượng quản lí (một người đọc và một một quyển sách).

Với cách tổ chức CSDL như trong ví dụ vừa nêu, mỗi bảng sẽ giảm được dữ liệu lặp lại, tránh thông tin dư thừa và việc cập nhật dữ liệu sẽ bớt được nhiều rủi ro sai nhằm.

# 2 Liên kết giữa các bảng và khoá ngoại

Để trích xuất thông tin từ CSDL quan hệ, ta có thể cần dữ liệu trong hơn một bảng và phải ghép nối đúng được dữ liệu giữa các bảng với nhau.

Để tham chiếu xác định thì thuộc tính liên kết hai bảng phải là khoá của bảng được tham chiếu, trong ví dụ này *Số thẻ TV* phải là khoá chính của bảng NGƯỜI ĐỌC và còn được gọi là *khoá ngoại* của bảng MƯỢN-TRẢ. Liên kết giữa hai bảng trong CSDL được thực hiện thông qua cặp khoá chính – khoá ngoại.

Khoá ngoại của một bảng: một trường (hay một số trường) của bảng này và đồng thời là khoá của một bảng khác.

# 3 Hệ quản trị CSDL đảm bảo ràng buộc khoá ngoại

### a) Ràng buộc khoá ngoại

Khi hai bảng trong một CSDL có liên kết với nhau, mỗi giá trị khoá ngoại ở bảng tham chiếu sẽ được giải thích chi tiết hơn ở bảng được tham chiếu. Ví dụ, "HS-001" được giải thích bằng thông tin "Họ và tên: Trần Văn An, Ngày sinh: 14/9/2006; Lớp: 12A2". Nếu có giá trị khoá ngoại nào không xuất hiện trong giá trị khoá ở bảng được tham chiếu thì xảy ra hiện tượng mất tham chiếu. "HS-007" không xuất hiện trong *Số thẻ TV* của bảng NGƯỜI ĐỌC. Do vậy, việc bổ sung cho bảng MƯỢN-TRẢ một bản ghi mới có giá trị khoá ngoại là "HS-007" sẽ làm cho dữ liệu trong CSDL không còn đúng nữa, không giải thích được "HS-007" là số thẻ thư viện của ai. Muốn cập nhật đó hợp lệ, phải bổ sung bản ghi có giá trị khoá là "HS-007" vào bảng NGƯỜI ĐỌC trước.

Đảm bảo tính tham chiếu đầy đủ giữa các bảng có liên kết với nhau cũng là một phần của việc đảm bảo tính toàn vẹn của dữ liệu. Ràng buộc này áp dụng cho khoá ngoại nên được gọi là *ràng buộc khoá ngoại*. Nói một cách cụ thể hơn, ràng buộc khoá ngoại là yêu cầu mọi giá trị của khoá ngoại trong bảng tham chiếu phải xuất hiện trong giá trị khoá ở bảng được tham chiếu.

### b) Khai báo liên kết giữa các bảng

Các hệ quản trị CSDL đều cho người tạo lập CSDL được khai báo liên kết giữa các bảng. Phần mềm quản trị CSDL sẽ căn cứ vào các liên kết đó để kiểm soát tất cả thao tác cập nhật, không để xảy ra những vi phạm ràng buộc khoá ngoại.

## Tóm tắt bài học

- CSDL quan hệ có thể gồm một số bảng, trong đó có những bảng có mối liên kết với nhau. Những liên kết này giúp tìm được những thông tin tin đúng đắn và đầy đủ.
- Nếu hai bảng có chung một trường và trường này là khoá của một trong hai bảng thì trường đó là khoá ngoại của bảng còn lại. Hai bảng có thể liên kết với nhau thông qua khoá ngoại.
- Dữ liệu trong hai bảng liên kết với nhau qua khoá ngoại cần phải thoả mãn ràng buộc khoá ngoại: Mọi giá trị khoá ngoại đều phải xuất hiện trong trường khoá ở bảng được tham chiếu. Mọi hệ quản trị CSDL quan hệ đều có cơ chế đảm bảo cập nhật dữ liệu không vi phạm ràng buộc khoá ngoại đối với các liên kết giữa các bảng.
